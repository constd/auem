# @package _global_

defaults:
  - /datamodule@data: generic
  - /dataset@data.datasets.train.random: random_audio
  - /dataset@data.datasets.validation.random: random_audio
  - /dataset@data.datasets.test.random: random_audio
  - /model@recipe.model: ganbase
  - /model@recipe.model.generator: melgan
  - /model/encoder@recipe.model.generator.encoder: mel
  - /model/discriminator@recipe.model.discriminator: combiner
  - /recipe: gan
  - /criterion@recipe.loss.generator: generator
  - /criterion@recipe.loss.generator.loss: lsgan
  - /criterion@recipe.loss.discriminator: discriminator
  - /criterion@recipe.loss.discriminator.loss: lsgan
  - /criterion@recipe.loss.feature: feature_matching
  - /criterion@recipe.loss.reconstruction: multimel
  - /optimizer@recipe.optimizer.generator: Adam
  - /optimizer@recipe.optimizer.discriminator: Adam
  # - /scheduler@recipe.scheduler.generator: Adam
  # - /scheduler@recipe.scheduler.discriminator: Adam
  - /trainer: lit
  - /callback@callbacks.log_audio: audiologger
  - /dataset@callbacks.log_audio.dataset: folder
  - /callback@callbacks.model_summary: modelsummary
  # - /callback@callbacks.model_checkpoint: checkpoint

callbacks:
  log_audio:
    dataset:
      data_dir: /path/to/a/folder/with/audio/files
      target_sample_rate: ${recipe.model.generator.sample_rate}
      num_channels: ${recipe.model.generator.num_channels}
      max_frames: null

data:
  datasets:
    train:
      random:
        n_examples: 100
        n_samples: 8192
    validation:
      random:
        n_examples: 100
        n_samples: 10000
    test:
      random:
        n_examples: 50
        n_samples: 10000
    batch_sizes:
      train: 10
      validation: 1
      test: 1

recipe:
  model:
    generator:
      encoder:
        n_mels: ${..n_mels}
      n_mels: 80
      # n_residual_layers: 1
      max_frames: 10000
      # ratios: [512]
  loss:
    feature:
      weight: 1.0
    reconstruction:
      weight: 1.0

trainer:
  fast_dev_run: true
  log_every_n_steps: 5
  check_val_every_n_epoch: 10
  accelerator: cpu
  logger: null
